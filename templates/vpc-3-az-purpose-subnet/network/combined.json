{"AWSTemplateFormatVersion": "2010-09-09", "Parameters": {"CorpSubnet1": {"AllowedPattern": "^(?:(?:[1-9]?[0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\\.){3}(?:[1-9]?[0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])/(?:[12]?[0-9]|3[0-2])$", "Default": "192.168.10.0/24", "Type": "String", "Description": "The subnet of the corporate LAN", "ConstraintDescription": "must be in CIDR notation (e.g., 192.168.0.0/24)"}, "VPCSupernetPrefix": {"AllowedPattern": "^(?:[1-9]?[0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\\.(?:[1-9]?[0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])$", "Default": "10.11", "Type": "String", "Description": "First 2 octets of the VPC CIDR supernet", "ConstraintDescription": "must only contain the first 2 octets"}, "VPCName": {"Default": "VPC", "MinLength": 1, "Type": "String", "Description": "The name of this VPC"}, "EnableDnsHostnames": {"Default": false, "Type": "String", "Description": "Specifies whether the instances launched in the VPC get DNS hostnames", "AllowedValues": [false, true]}, "AvailabilityZones": {"Default": "a,b,c", "Type": "CommaDelimitedList", "Description": "The availability zones this VPC should span. Only the first 3 will be used"}}, "Resources": {"AssociateEIPENINATAZ3": {"Type": "AWS::EC2::EIPAssociation", "Properties": {"NetworkInterfaceId": {"Ref": "ENINATAZ3"}, "AllocationId": {"Fn::GetAtt": ["EIPNATAZ3", "AllocationId"]}}}, "AssociateEIPENINATAZ2": {"Type": "AWS::EC2::EIPAssociation", "Properties": {"NetworkInterfaceId": {"Ref": "ENINATAZ2"}, "AllocationId": {"Fn::GetAtt": ["EIPNATAZ2", "AllocationId"]}}}, "AssociateEIPENINATAZ1": {"Type": "AWS::EC2::EIPAssociation", "Properties": {"NetworkInterfaceId": {"Ref": "ENINATAZ1"}, "AllocationId": {"Fn::GetAtt": ["EIPNATAZ1", "AllocationId"]}}}, "SubnetPublicRDSAZ1": {"Type": "AWS::EC2::Subnet", "Properties": {"Tags": [{"Key": "Name", "Value": {"Fn::Join": ["", ["Public/Internet facing RDSs AZ ", {"Fn::Select": [0, {"Ref": "AvailabilityZones"}]}, " (", {"Ref": "VPCName"}, ")"]]}}], "VpcId": {"Ref": "VPC"}, "CidrBlock": {"Fn::Join": [".", [{"Ref": "VPCSupernetPrefix"}, "20.0/24"]]}, "AvailabilityZone": {"Fn::Join": ["", [{"Ref": "AWS::Region"}, {"Fn::Select": [0, {"Ref": "AvailabilityZones"}]}]]}}}, "RouteTableNATAZ1": {"Type": "AWS::EC2::RouteTable", "Properties": {"VpcId": {"Ref": "VPC"}, "Tags": [{"Key": "Name", "Value": {"Fn::Join": ["", ["NAT AZ ", {"Fn::Select": [0, {"Ref": "AvailabilityZones"}]}, " (", {"Ref": "VPCName"}, ")"]]}}]}}, "RouteNATAZ1": {"Type": "AWS::EC2::Route", "Properties": {"DestinationCidrBlock": "0.0.0.0/0", "NetworkInterfaceId": {"Ref": "ENINATAZ1"}, "RouteTableId": {"Ref": "RouteTableNATAZ1"}}}, "RouteTableNATAZ3": {"Type": "AWS::EC2::RouteTable", "Properties": {"VpcId": {"Ref": "VPC"}, "Tags": [{"Key": "Name", "Value": {"Fn::Join": ["", ["NAT AZ ", {"Fn::Select": [2, {"Ref": "AvailabilityZones"}]}, " (", {"Ref": "VPCName"}, ")"]]}}]}}, "RouteNATAZ3": {"Type": "AWS::EC2::Route", "Properties": {"DestinationCidrBlock": "0.0.0.0/0", "NetworkInterfaceId": {"Ref": "ENINATAZ3"}, "RouteTableId": {"Ref": "RouteTableNATAZ3"}}}, "AssociateSubnetPublicELBAZ3RouteTableInternetGateway": {"Type": "AWS::EC2::SubnetRouteTableAssociation", "Properties": {"SubnetId": {"Ref": "SubnetPublicELBAZ3"}, "RouteTableId": {"Ref": "RouteTableInternetGateway"}}}, "AssociateSubnetPublicRDSAZ2RouteTableInternetGateway": {"Type": "AWS::EC2::SubnetRouteTableAssociation", "Properties": {"SubnetId": {"Ref": "SubnetPublicRDSAZ2"}, "RouteTableId": {"Ref": "RouteTableInternetGateway"}}}, "SGAllowAllFromVPCIngressAllow": {"Type": "AWS::EC2::SecurityGroupIngress", "Properties": {"SourceSecurityGroupId": {"Ref": "SGAllowAllFromVPC"}, "FromPort": -1, "ToPort": -1, "GroupId": {"Ref": "SGAllowAllFromVPC"}, "IpProtocol": -1}}, "SubnetPublicRDSAZ2": {"Type": "AWS::EC2::Subnet", "Properties": {"Tags": [{"Key": "Name", "Value": {"Fn::Join": ["", ["Public/Internet facing RDSs AZ ", {"Fn::Select": [1, {"Ref": "AvailabilityZones"}]}, " (", {"Ref": "VPCName"}, ")"]]}}], "VpcId": {"Ref": "VPC"}, "CidrBlock": {"Fn::Join": [".", [{"Ref": "VPCSupernetPrefix"}, "21.0/24"]]}, "AvailabilityZone": {"Fn::Join": ["", [{"Ref": "AWS::Region"}, {"Fn::Select": [1, {"Ref": "AvailabilityZones"}]}]]}}}, "SubnetPublicRDSAZ3": {"Type": "AWS::EC2::Subnet", "Properties": {"Tags": [{"Key": "Name", "Value": {"Fn::Join": ["", ["Public/Internet facing RDSs AZ ", {"Fn::Select": [2, {"Ref": "AvailabilityZones"}]}, " (", {"Ref": "VPCName"}, ")"]]}}], "VpcId": {"Ref": "VPC"}, "CidrBlock": {"Fn::Join": [".", [{"Ref": "VPCSupernetPrefix"}, "22.0/24"]]}, "AvailabilityZone": {"Fn::Join": ["", [{"Ref": "AWS::Region"}, {"Fn::Select": [2, {"Ref": "AvailabilityZones"}]}]]}}}, "EIPNATAZ3": {"Type": "AWS::EC2::EIP", "Properties": {"Domain": "vpc"}, "DependsOn": "VPC"}, "EIPNATAZ2": {"Type": "AWS::EC2::EIP", "Properties": {"Domain": "vpc"}, "DependsOn": "VPC"}, "EIPNATAZ1": {"Type": "AWS::EC2::EIP", "Properties": {"Domain": "vpc"}, "DependsOn": "VPC"}, "InternetGateway": {"Type": "AWS::EC2::InternetGateway", "Properties": {"Tags": [{"Value": {"Ref": "VPCName"}, "Key": "Name"}]}}, "AssociateSubnetNATAZ3RouteTableInternetGateway": {"Type": "AWS::EC2::SubnetRouteTableAssociation", "Properties": {"SubnetId": {"Ref": "SubnetNATAZ3"}, "RouteTableId": {"Ref": "RouteTableInternetGateway"}}}, "RouteTableInternetGateway": {"Type": "AWS::EC2::RouteTable", "Properties": {"VpcId": {"Ref": "VPC"}, "Tags": [{"Value": {"Fn::Join": ["", ["Direct Internet (", {"Ref": "VPCName"}, ")"]]}, "Key": "Name"}]}}, "AssociateSubnetPublicRDSAZ1RouteTableInternetGateway": {"Type": "AWS::EC2::SubnetRouteTableAssociation", "Properties": {"SubnetId": {"Ref": "SubnetPublicRDSAZ1"}, "RouteTableId": {"Ref": "RouteTableInternetGateway"}}}, "SubnetPrivateELBAZ1": {"Type": "AWS::EC2::Subnet", "Properties": {"Tags": [{"Key": "Name", "Value": {"Fn::Join": ["", ["Private/internal ELBs AZ ", {"Fn::Select": [0, {"Ref": "AvailabilityZones"}]}, " (", {"Ref": "VPCName"}, ")"]]}}], "VpcId": {"Ref": "VPC"}, "CidrBlock": {"Fn::Join": [".", [{"Ref": "VPCSupernetPrefix"}, "15.0/24"]]}, "AvailabilityZone": {"Fn::Join": ["", [{"Ref": "AWS::Region"}, {"Fn::Select": [0, {"Ref": "AvailabilityZones"}]}]]}}}, "AssociateSubnetPrivateELBAZ1RouteTableNATAZ1": {"Type": "AWS::EC2::SubnetRouteTableAssociation", "Properties": {"SubnetId": {"Ref": "SubnetPrivateELBAZ1"}, "RouteTableId": {"Ref": "RouteTableNATAZ1"}}}, "SubnetPrivateELBAZ3": {"Type": "AWS::EC2::Subnet", "Properties": {"Tags": [{"Key": "Name", "Value": {"Fn::Join": ["", ["Private/internal ELBs AZ ", {"Fn::Select": [2, {"Ref": "AvailabilityZones"}]}, " (", {"Ref": "VPCName"}, ")"]]}}], "VpcId": {"Ref": "VPC"}, "CidrBlock": {"Fn::Join": [".", [{"Ref": "VPCSupernetPrefix"}, "17.0/24"]]}, "AvailabilityZone": {"Fn::Join": ["", [{"Ref": "AWS::Region"}, {"Fn::Select": [2, {"Ref": "AvailabilityZones"}]}]]}}}, "SubnetPrivateELBAZ2": {"Type": "AWS::EC2::Subnet", "Properties": {"Tags": [{"Key": "Name", "Value": {"Fn::Join": ["", ["Private/internal ELBs AZ ", {"Fn::Select": [1, {"Ref": "AvailabilityZones"}]}, " (", {"Ref": "VPCName"}, ")"]]}}], "VpcId": {"Ref": "VPC"}, "CidrBlock": {"Fn::Join": [".", [{"Ref": "VPCSupernetPrefix"}, "16.0/24"]]}, "AvailabilityZone": {"Fn::Join": ["", [{"Ref": "AWS::Region"}, {"Fn::Select": [1, {"Ref": "AvailabilityZones"}]}]]}}}, "DBSubnetPublic": {"Type": "AWS::RDS::DBSubnetGroup", "Properties": {"SubnetIds": [{"Ref": "SubnetPublicRDSAZ1"}, {"Ref": "SubnetPublicRDSAZ2"}, {"Ref": "SubnetPublicRDSAZ3"}], "DBSubnetGroupDescription": {"Fn::Join": ["", ["Public (", {"Ref": "VPCName"}, ")"]]}}}, "RouteNATAZ2": {"Type": "AWS::EC2::Route", "Properties": {"DestinationCidrBlock": "0.0.0.0/0", "NetworkInterfaceId": {"Ref": "ENINATAZ2"}, "RouteTableId": {"Ref": "RouteTableNATAZ2"}}}, "VPC": {"Type": "AWS::EC2::VPC", "Properties": {"CidrBlock": {"Fn::Join": [".", [{"Ref": "VPCSupernetPrefix"}, "0.0/16"]]}, "EnableDnsHostnames": {"Ref": "EnableDnsHostnames"}, "Tags": [{"Value": {"Ref": "VPCName"}, "Key": "Name"}]}}, "SubnetNATAZ3": {"Type": "AWS::EC2::Subnet", "Properties": {"Tags": [{"Key": "Name", "Value": {"Fn::Join": ["", ["NAT/Proxies/Tunnels/etc AZ ", {"Fn::Select": [2, {"Ref": "AvailabilityZones"}]}, ", requires EIP/Public IP (", {"Ref": "VPCName"}, ")"]]}}], "VpcId": {"Ref": "VPC"}, "CidrBlock": {"Fn::Join": [".", [{"Ref": "VPCSupernetPrefix"}, "2.0/24"]]}, "AvailabilityZone": {"Fn::Join": ["", [{"Ref": "AWS::Region"}, {"Fn::Select": [2, {"Ref": "AvailabilityZones"}]}]]}}}, "SubnetNATAZ2": {"Type": "AWS::EC2::Subnet", "Properties": {"Tags": [{"Key": "Name", "Value": {"Fn::Join": ["", ["NAT/Proxies/Tunnels/etc AZ ", {"Fn::Select": [1, {"Ref": "AvailabilityZones"}]}, ", requires EIP/Public IP (", {"Ref": "VPCName"}, ")"]]}}], "VpcId": {"Ref": "VPC"}, "CidrBlock": {"Fn::Join": [".", [{"Ref": "VPCSupernetPrefix"}, "1.0/24"]]}, "AvailabilityZone": {"Fn::Join": ["", [{"Ref": "AWS::Region"}, {"Fn::Select": [1, {"Ref": "AvailabilityZones"}]}]]}}}, "SubnetNATAZ1": {"Type": "AWS::EC2::Subnet", "Properties": {"Tags": [{"Key": "Name", "Value": {"Fn::Join": ["", ["NAT/Proxies/Tunnels/etc AZ ", {"Fn::Select": [0, {"Ref": "AvailabilityZones"}]}, ", requires EIP/Public IP (", {"Ref": "VPCName"}, ")"]]}}], "VpcId": {"Ref": "VPC"}, "CidrBlock": {"Fn::Join": [".", [{"Ref": "VPCSupernetPrefix"}, "0.0/24"]]}, "AvailabilityZone": {"Fn::Join": ["", [{"Ref": "AWS::Region"}, {"Fn::Select": [0, {"Ref": "AvailabilityZones"}]}]]}}}, "RouteTableNATAZ2": {"Type": "AWS::EC2::RouteTable", "Properties": {"VpcId": {"Ref": "VPC"}, "Tags": [{"Key": "Name", "Value": {"Fn::Join": ["", ["NAT AZ ", {"Fn::Select": [1, {"Ref": "AvailabilityZones"}]}, " (", {"Ref": "VPCName"}, ")"]]}}]}}, "SubnetPrivateRDSAZ3": {"Type": "AWS::EC2::Subnet", "Properties": {"Tags": [{"Key": "Name", "Value": {"Fn::Join": ["", ["Private/internal RDSs AZ ", {"Fn::Select": [2, {"Ref": "AvailabilityZones"}]}, " (", {"Ref": "VPCName"}, ")"]]}}], "VpcId": {"Ref": "VPC"}, "CidrBlock": {"Fn::Join": [".", [{"Ref": "VPCSupernetPrefix"}, "27.0/24"]]}, "AvailabilityZone": {"Fn::Join": ["", [{"Ref": "AWS::Region"}, {"Fn::Select": [2, {"Ref": "AvailabilityZones"}]}]]}}}, "SubnetPrivateRDSAZ2": {"Type": "AWS::EC2::Subnet", "Properties": {"Tags": [{"Key": "Name", "Value": {"Fn::Join": ["", ["Private/internal RDSs AZ ", {"Fn::Select": [1, {"Ref": "AvailabilityZones"}]}, " (", {"Ref": "VPCName"}, ")"]]}}], "VpcId": {"Ref": "VPC"}, "CidrBlock": {"Fn::Join": [".", [{"Ref": "VPCSupernetPrefix"}, "26.0/24"]]}, "AvailabilityZone": {"Fn::Join": ["", [{"Ref": "AWS::Region"}, {"Fn::Select": [1, {"Ref": "AvailabilityZones"}]}]]}}}, "SubnetPrivateRDSAZ1": {"Type": "AWS::EC2::Subnet", "Properties": {"Tags": [{"Key": "Name", "Value": {"Fn::Join": ["", ["Private/internal RDSs AZ ", {"Fn::Select": [0, {"Ref": "AvailabilityZones"}]}, " (", {"Ref": "VPCName"}, ")"]]}}], "VpcId": {"Ref": "VPC"}, "CidrBlock": {"Fn::Join": [".", [{"Ref": "VPCSupernetPrefix"}, "25.0/24"]]}, "AvailabilityZone": {"Fn::Join": ["", [{"Ref": "AWS::Region"}, {"Fn::Select": [0, {"Ref": "AvailabilityZones"}]}]]}}}, "SGAllowHTTPFromEverywhere": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"SecurityGroupIngress": [{"ToPort": 80, "FromPort": 80, "CidrIp": "0.0.0.0/0", "IpProtocol": "tcp"}, {"ToPort": 443, "FromPort": 443, "CidrIp": "0.0.0.0/0", "IpProtocol": "tcp"}], "VpcId": {"Ref": "VPC"}, "GroupDescription": "Allow HTTP from everywhere", "Tags": [{"Key": "Name", "Value": {"Fn::Join": ["", ["HTTP (", {"Ref": "VPCName"}, ")"]]}}]}}, "AssociateSubnetPublicELBAZ2RouteTableInternetGateway": {"Type": "AWS::EC2::SubnetRouteTableAssociation", "Properties": {"SubnetId": {"Ref": "SubnetPublicELBAZ2"}, "RouteTableId": {"Ref": "RouteTableInternetGateway"}}}, "RouteInternetGateway": {"Type": "AWS::EC2::Route", "Properties": {"GatewayId": {"Ref": "InternetGateway"}, "DestinationCidrBlock": "0.0.0.0/0", "RouteTableId": {"Ref": "RouteTableInternetGateway"}}}, "AssociateSubnetPublicELBAZ1RouteTableInternetGateway": {"Type": "AWS::EC2::SubnetRouteTableAssociation", "Properties": {"SubnetId": {"Ref": "SubnetPublicELBAZ1"}, "RouteTableId": {"Ref": "RouteTableInternetGateway"}}}, "AssociateSubnetNATAZ2RouteTableInternetGateway": {"Type": "AWS::EC2::SubnetRouteTableAssociation", "Properties": {"SubnetId": {"Ref": "SubnetNATAZ2"}, "RouteTableId": {"Ref": "RouteTableInternetGateway"}}}, "SGAllowAllFromVPC": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"VpcId": {"Ref": "VPC"}, "GroupDescription": "Allow all from within the VPC", "Tags": [{"Key": "Name", "Value": {"Fn::Join": ["", ["Within VPC (", {"Ref": "VPCName"}, ")"]]}}]}}, "SGAllowAllFromCorp": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"SecurityGroupIngress": [{"ToPort": -1, "FromPort": -1, "CidrIp": {"Ref": "CorpSubnet1"}, "IpProtocol": -1}], "VpcId": {"Ref": "VPC"}, "GroupDescription": "Allow all from Corp", "Tags": [{"Key": "Name", "Value": {"Fn::Join": ["", ["Corp (", {"Ref": "VPCName"}, ")"]]}}]}}, "AssociateSubnetPrivateRDSAZ3RouteTableNATAZ1": {"Type": "AWS::EC2::SubnetRouteTableAssociation", "Properties": {"SubnetId": {"Ref": "SubnetPrivateRDSAZ3"}, "RouteTableId": {"Ref": "RouteTableNATAZ1"}}}, "AssociateSubnetPrivateDevAZ3RouteTableNATAZ1": {"Type": "AWS::EC2::SubnetRouteTableAssociation", "Properties": {"SubnetId": {"Ref": "SubnetPrivateDevAZ3"}, "RouteTableId": {"Ref": "RouteTableNATAZ1"}}}, "ENINATAZ3": {"Type": "AWS::EC2::NetworkInterface", "Properties": {"SubnetId": {"Ref": "SubnetNATAZ3"}, "SourceDestCheck": false, "GroupSet": [{"Ref": "SGAllowAllFromVPC"}, {"Ref": "SGAllowAllFromCorp"}], "Description": {"Fn::Join": [" ", ["NAT AZ", {"Fn::Select": [2, {"Ref": "AvailabilityZones"}]}]]}, "Tags": [{"Key": "Name", "Value": {"Fn::Join": ["", ["NAT-", {"Fn::Select": [2, {"Ref": "AvailabilityZones"}]}, " (", {"Ref": "VPCName"}, ")"]]}}]}}, "ENINATAZ2": {"Type": "AWS::EC2::NetworkInterface", "Properties": {"SubnetId": {"Ref": "SubnetNATAZ2"}, "SourceDestCheck": false, "GroupSet": [{"Ref": "SGAllowAllFromVPC"}, {"Ref": "SGAllowAllFromCorp"}], "Description": {"Fn::Join": [" ", ["NAT AZ", {"Fn::Select": [1, {"Ref": "AvailabilityZones"}]}]]}, "Tags": [{"Key": "Name", "Value": {"Fn::Join": ["", ["NAT-", {"Fn::Select": [1, {"Ref": "AvailabilityZones"}]}, " (", {"Ref": "VPCName"}, ")"]]}}]}}, "ENINATAZ1": {"Type": "AWS::EC2::NetworkInterface", "Properties": {"SubnetId": {"Ref": "SubnetNATAZ1"}, "SourceDestCheck": false, "GroupSet": [{"Ref": "SGAllowAllFromVPC"}, {"Ref": "SGAllowAllFromCorp"}], "Description": {"Fn::Join": [" ", ["NAT AZ", {"Fn::Select": [0, {"Ref": "AvailabilityZones"}]}]]}, "Tags": [{"Key": "Name", "Value": {"Fn::Join": ["", ["NAT-", {"Fn::Select": [0, {"Ref": "AvailabilityZones"}]}, " (", {"Ref": "VPCName"}, ")"]]}}]}}, "AssociateSubnetPrivateELBAZ3RouteTableNATAZ1": {"Type": "AWS::EC2::SubnetRouteTableAssociation", "Properties": {"SubnetId": {"Ref": "SubnetPrivateELBAZ3"}, "RouteTableId": {"Ref": "RouteTableNATAZ1"}}}, "AssociateSubnetPrivateRDSAZ1RouteTableNATAZ1": {"Type": "AWS::EC2::SubnetRouteTableAssociation", "Properties": {"SubnetId": {"Ref": "SubnetPrivateRDSAZ1"}, "RouteTableId": {"Ref": "RouteTableNATAZ1"}}}, "AssociateSubnetPublicRDSAZ3RouteTableInternetGateway": {"Type": "AWS::EC2::SubnetRouteTableAssociation", "Properties": {"SubnetId": {"Ref": "SubnetPublicRDSAZ3"}, "RouteTableId": {"Ref": "RouteTableInternetGateway"}}}, "AssociateSubnetPrivateDevAZ1RouteTableNATAZ1": {"Type": "AWS::EC2::SubnetRouteTableAssociation", "Properties": {"SubnetId": {"Ref": "SubnetPrivateDevAZ1"}, "RouteTableId": {"Ref": "RouteTableNATAZ1"}}}, "SubnetPublicELBAZ1": {"Type": "AWS::EC2::Subnet", "Properties": {"Tags": [{"Key": "Name", "Value": {"Fn::Join": ["", ["Public/Internet facing ELBs AZ ", {"Fn::Select": [0, {"Ref": "AvailabilityZones"}]}, " (", {"Ref": "VPCName"}, ")"]]}}], "VpcId": {"Ref": "VPC"}, "CidrBlock": {"Fn::Join": [".", [{"Ref": "VPCSupernetPrefix"}, "10.0/24"]]}, "AvailabilityZone": {"Fn::Join": ["", [{"Ref": "AWS::Region"}, {"Fn::Select": [0, {"Ref": "AvailabilityZones"}]}]]}}}, "SubnetPublicELBAZ2": {"Type": "AWS::EC2::Subnet", "Properties": {"Tags": [{"Key": "Name", "Value": {"Fn::Join": ["", ["Public/Internet facing ELBs AZ ", {"Fn::Select": [1, {"Ref": "AvailabilityZones"}]}, " (", {"Ref": "VPCName"}, ")"]]}}], "VpcId": {"Ref": "VPC"}, "CidrBlock": {"Fn::Join": [".", [{"Ref": "VPCSupernetPrefix"}, "11.0/24"]]}, "AvailabilityZone": {"Fn::Join": ["", [{"Ref": "AWS::Region"}, {"Fn::Select": [1, {"Ref": "AvailabilityZones"}]}]]}}}, "DBSubnetPrivate": {"Type": "AWS::RDS::DBSubnetGroup", "Properties": {"SubnetIds": [{"Ref": "SubnetPrivateRDSAZ1"}, {"Ref": "SubnetPrivateRDSAZ2"}, {"Ref": "SubnetPrivateRDSAZ3"}], "DBSubnetGroupDescription": {"Fn::Join": ["", ["Private (", {"Ref": "VPCName"}, ")"]]}}}, "SubnetPrivateDevAZ3": {"Type": "AWS::EC2::Subnet", "Properties": {"Tags": [{"Key": "Name", "Value": {"Fn::Join": ["", ["Dev/misc AZ ", {"Fn::Select": [2, {"Ref": "AvailabilityZones"}]}, ", uses NAT (", {"Ref": "VPCName"}, ")"]]}}], "VpcId": {"Ref": "VPC"}, "CidrBlock": {"Fn::Join": [".", [{"Ref": "VPCSupernetPrefix"}, "72.0/24"]]}, "AvailabilityZone": {"Fn::Join": ["", [{"Ref": "AWS::Region"}, {"Fn::Select": [2, {"Ref": "AvailabilityZones"}]}]]}}}, "SubnetPrivateDevAZ2": {"Type": "AWS::EC2::Subnet", "Properties": {"Tags": [{"Key": "Name", "Value": {"Fn::Join": ["", ["Dev/misc AZ ", {"Fn::Select": [1, {"Ref": "AvailabilityZones"}]}, ", uses NAT (", {"Ref": "VPCName"}, ")"]]}}], "VpcId": {"Ref": "VPC"}, "CidrBlock": {"Fn::Join": [".", [{"Ref": "VPCSupernetPrefix"}, "71.0/24"]]}, "AvailabilityZone": {"Fn::Join": ["", [{"Ref": "AWS::Region"}, {"Fn::Select": [1, {"Ref": "AvailabilityZones"}]}]]}}}, "SubnetPrivateDevAZ1": {"Type": "AWS::EC2::Subnet", "Properties": {"Tags": [{"Key": "Name", "Value": {"Fn::Join": ["", ["Dev/misc AZ ", {"Fn::Select": [0, {"Ref": "AvailabilityZones"}]}, ", uses NAT (", {"Ref": "VPCName"}, ")"]]}}], "VpcId": {"Ref": "VPC"}, "CidrBlock": {"Fn::Join": [".", [{"Ref": "VPCSupernetPrefix"}, "70.0/24"]]}, "AvailabilityZone": {"Fn::Join": ["", [{"Ref": "AWS::Region"}, {"Fn::Select": [0, {"Ref": "AvailabilityZones"}]}]]}}}, "AssociateSubnetPrivateDevAZ2RouteTableNATAZ2": {"Type": "AWS::EC2::SubnetRouteTableAssociation", "Properties": {"SubnetId": {"Ref": "SubnetPrivateDevAZ2"}, "RouteTableId": {"Ref": "RouteTableNATAZ2"}}}, "AssociateSubnetNATAZ1RouteTableInternetGateway": {"Type": "AWS::EC2::SubnetRouteTableAssociation", "Properties": {"SubnetId": {"Ref": "SubnetNATAZ1"}, "RouteTableId": {"Ref": "RouteTableInternetGateway"}}}, "AttachInternetGateway": {"Type": "AWS::EC2::VPCGatewayAttachment", "Properties": {"VpcId": {"Ref": "VPC"}, "InternetGatewayId": {"Ref": "InternetGateway"}}}, "AssociateSubnetPrivateELBAZ2RouteTableNATAZ2": {"Type": "AWS::EC2::SubnetRouteTableAssociation", "Properties": {"SubnetId": {"Ref": "SubnetPrivateELBAZ2"}, "RouteTableId": {"Ref": "RouteTableNATAZ2"}}}, "SubnetPublicELBAZ3": {"Type": "AWS::EC2::Subnet", "Properties": {"Tags": [{"Key": "Name", "Value": {"Fn::Join": ["", ["Public/Internet facing ELBs AZ ", {"Fn::Select": [2, {"Ref": "AvailabilityZones"}]}, " (", {"Ref": "VPCName"}, ")"]]}}], "VpcId": {"Ref": "VPC"}, "CidrBlock": {"Fn::Join": [".", [{"Ref": "VPCSupernetPrefix"}, "12.0/24"]]}, "AvailabilityZone": {"Fn::Join": ["", [{"Ref": "AWS::Region"}, {"Fn::Select": [2, {"Ref": "AvailabilityZones"}]}]]}}}, "AssociateSubnetPrivateRDSAZ2RouteTableNATAZ2": {"Type": "AWS::EC2::SubnetRouteTableAssociation", "Properties": {"SubnetId": {"Ref": "SubnetPrivateRDSAZ2"}, "RouteTableId": {"Ref": "RouteTableNATAZ2"}}}}, "Description": "VPC spanning 3 AZs with purpose-based subnets"}